<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
	<script src="https://code.jquery.com/jquery-1.10.2.js"></script>
	<!--<script src="//mrrio.github.io/jsPDF/dist/jspdf.debug.js"></script>-->
	<script src="http://mrrio.github.io/jsPDF/dist/jspdf.debug.js"></script>
	<!--<script src="javascripts/pdfmake.min.js" type="text/javascript"></script>
	<script src="javascripts/vfs_fonts.js" type="text/javascript"></script>-->
    <script src="javascripts/main.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="header">
    <% include templates/header.ejs %>
    </div>
    <!-- <form action="/add" method="POST"><input type="text" name="fff"><input type="submit"></form> -->
    <div class="main"> 
    			<div class="span6" style="float: left">
					<iframe class="preview-pane" type="application/pdf" width="350px" height="600px" 
					frameborder="0" style="position:relative;z-index:999"></iframe>
				</div>
    <script>
    var v;
    var doc = new jsPDF();	// global
    function preparePDF() {
    	var x = 10;			// left horizontal border
    	var y = 20;			// top vertical border
    	var maxX = x+190;	// right horizontal border
    	var midX = x+38;
    	var interval = 8;	// between the normal lines
        v=(<%= person.education.length %>)*2*interval;      // doc.addPage('a4');
        doc.setFontSize(25);
		doc.text(x, y, "<%= person.fullName %>");	// first and last names
		// doc.text(5,5, a);
		doc.setLineWidth(0.3);
		doc.line(x, y+12, maxX, y+12);		// line
        if("<%= person.pic %>"){            // if image was uploaded
            doc.addImage("<%= person.pic %>", 'JPEG', maxX-26, 4, 26, 26);
        }
		doc.setFontSize(14); doc.setTextColor(255, 255, 255);
		doc.rect(x-1, y+30-1, 34, 7, 'F');
		doc.rect(x-1, y+30*2-1, 34, 7, 'F');
		doc.rect(x-1, y+30*3-1, 34, 7, 'F');
		doc.rect(x-1, y+30*3-1+v, 34, 15, 'F');
		doc.rect(x-1, y+30*4-1+v, 34, 7, 'F');
		doc.textEx("CONTACT", x, y+30, "left");
		doc.textEx("PERSONAL", x, y+30*2, "left");
		doc.textEx("EDUCATION", x, y+30*3, "left");
		doc.textEx("WORK", x, y+30*3+v, "left");doc.textEx("EXPERIENCE", x, y+30*3+8+v, "left");
		doc.textEx("SKILLS", x, y+30*4+v, "left");
		doc.setFontSize(12); doc.setTextColor(0, 0, 0);
		doc.textEx("Email: <%= person.email %>", maxX, y+30, "right");
		doc.textEx("Phone: <%= person.phone %>", maxX, y+30+interval, "right");
		doc.textEx("<%= person.address %>", midX, y+30, "left");
		
		doc.textEx("Date of birth: <%= person.born %>", midX, y+30*2, "left");				// DOB
		doc.textEx("Citizenship: <%= person.citizenship %>", midX, y+30*2+interval*1, "left");	// citizenship

		<% for (var i=0; i < person.education.length; i++) { %>
			doc.setFontType("bold");
			doc.textEx("<%= person.education[i].university %>", midX, y+30*3+interval*<%= i*2 %>, "left");			// uni
			doc.setFontType("normal");
			doc.textEx("<%= person.education[i].faculty %>", midX, y+30*3+interval*(<%= i*2 %>+1), "left");			// faculty
			doc.textEx("<%= person.education[i].from %> - <%= person.education[i].till %>", maxX, y+30*3+interval*<%= i*2 %>, "right");
		<% }%>
		console.log("<%= person.education.length %> -----sssss")
		var string = doc.output('bloburi');
		// console.log("person.citizenship");
		$('.preview-pane').attr('src', string);
    }
    preparePDF();
</script>
    <p>Please fill the fields below</p>
		<form action="/add" method="POST">
			Full name <input type="text" name="full_name" value="Alexandru Oat"><br/><br/>
			Date of birth <input type="date" name="born" max="2002-12-31" value="1982-03-23"><br/><br/>
			Email <input type="email" name="email" value="oat.alexandru@gmail.com"><br/><br/>
			Phone <input type="text" name="phone" value="+358466360623"><br/><br/>
			Address <input type="text" name="address" value="Rälssintie 16 B 14 Helsinki"><br/><br/>
			Citizenship <input type="text" name="citizenship" value="Moldova"><br/><br/>
			Education University <input type="text" name="university" value="Haaga-Helia University of Applied Sciences">
			Faculty <input type="text" name="faculty" value="Business Information Technology">
			Period from <input type="month" name="edu_from" value="2013-08">till <input type="month" name="edu_till" value="2016-12"><br/><br/>
            <input type="hidden" name="pic" id="pic" >
			<input type="submit" value="Preview">
		</form>

<input id="inputFileToLoad" type="file" value="Add photo" />
<div id="imgTest"></div>


		<br/><br/><br/><br/><br/><br/><br/><br/>
 		<a href="javascript:savePDF()" class="button">Download PDF</a>

<script type='text/javascript'>

</script>
    </div>
    <div class="footer"> <% include templates/footer.ejs %></div>
  </body>
</html>
